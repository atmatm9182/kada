#!/usr/bin/env sh
# -*- mode: scheme; -*-
exec guile --no-auto-compile -e main -s "$0" "$@"
!#

(use-modules (ice-9 match)
             (ice-9 format)
             (srfi srfi-9)
             (kada db)
             (kada types))
;; (print
;;  (strftime "%c"
;;            (localtime
;;             (current-time))))

(define main
  (match-lambda
    ((program cmd rest ...)
     (match (assoc cmd *cmd-handlers*)
       (#f (error (format #f "Uncrecognized subcommand '~a'" cmd)))
       ((_ . handler) (handler rest))))
    ((program rest ...)
     (error "No subcommand provided. Aborting."))))

(define (item-enter args)
  (when (not (= (length args) 1))
    (error "Invalid number of arguments for 'enter'"))
  (let* ((name (car args))
         (entry (make-entry name (current-time) #f)))
    (db-insert-entry! entry)
    (format #t "Successfully created entry '~a'\n" name)))

(define (item-leave args)
  (error "TODO: item-leave"))

(define *cmd-handlers*
  `(("enter" . ,item-enter)
    ("leave" . ,item-leave)))
